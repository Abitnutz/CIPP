"use strict";(self.webpackChunkcipp_docs=self.webpackChunkcipp_docs||[]).push([[9969],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return p}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=o.createContext({}),h=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=h(e.components);return o.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,u=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=h(n),p=a,m=d["".concat(u,".").concat(p)]||d[p]||c[p]||r;return n?o.createElement(m,i(i({ref:t},l),{},{components:n})):o.createElement(m,i({ref:t},l))}));function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var h=2;h<r;h++)i[h]=n[h];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1965:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return u},default:function(){return p},frontMatter:function(){return s},metadata:function(){return h},toc:function(){return c}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],s={id:"troubleshooting",title:"Troubleshooting",description:"Troubleshooting information for issues with CIPP.",slug:"/troubleshooting"},u=void 0,h={unversionedId:"troubleshooting",id:"troubleshooting",title:"Troubleshooting",description:"Troubleshooting information for issues with CIPP.",source:"@site/docs/general/troubleshooting.md",sourceDirName:".",slug:"/troubleshooting",permalink:"/docs/general/troubleshooting",editUrl:"https://github.com/KelvinTegelaar/CIPP/tree/website/docs/general/troubleshooting.md",tags:[],version:"current",lastUpdatedBy:"KelvinTegelaar",lastUpdatedAt:1680799059,formattedLastUpdatedAt:"06/04/2023",frontMatter:{id:"troubleshooting",title:"Troubleshooting",description:"Troubleshooting information for issues with CIPP.",slug:"/troubleshooting"}},l={},c=[{value:"Clear Token Cache",id:"clear-token-cache",level:2},{value:"Multi-Factor Authentication Troubleshooting",id:"multi-factor-authentication-troubleshooting",level:2},{value:"Request not applicable to target tenant.",id:"request-not-applicable-to-target-tenant",level:2},{value:"Neither tenant is B2C or tenant doesn&#39;t have premium license",id:"neither-tenant-is-b2c-or-tenant-doesnt-have-premium-license",level:2},{value:"Response status code does not indicate success: 400 (Bad Request).",id:"response-status-code-does-not-indicate-success-400-bad-request",level:2},{value:"<em>Microsoft.Skype.Sync.Pstn.Tnm.Common.Http.HttpResponseException</em>",id:"microsoftskypesyncpstntnmcommonhttphttpresponseexception",level:2},{value:"<em>Provide valid credential.</em>",id:"provide-valid-credential",level:2},{value:"subscription within the tenant has lapsed",id:"subscription-within-the-tenant-has-lapsed",level:2},{value:"<em>User was not found.</em>",id:"user-was-not-found",level:2},{value:"<em>The user or administrator has not consented to use the application</em>",id:"the-user-or-administrator-has-not-consented-to-use-the-application",level:2},{value:"<em>AADSTS50020</em> or The user you have used for your Secure Application Model is a guest in this tenant, or your are using GDAP and have not added the user to the correct group. Please delete the guest user to gain access to this tenant.",id:"aadsts50020-or-the-user-you-have-used-for-your-secure-application-model-is-a-guest-in-this-tenant-or-your-are-using-gdap-and-have-not-added-the-user-to-the-correct-group-please-delete-the-guest-user-to-gain-access-to-this-tenant",level:2},{value:"<em>invalid or malformed</em>",id:"invalid-or-malformed",level:2},{value:"<em>Windows Store repository apps feature is not supported for this tenant</em>",id:"windows-store-repository-apps-feature-is-not-supported-for-this-tenant",level:2},{value:"AADSTS650051",id:"aadsts650051",level:2},{value:"<em>AppLifecycle_2210</em>",id:"applifecycle_2210",level:2},{value:"Insufficient access rights to perform the operation.",id:"insufficient-access-rights-to-perform-the-operation",level:2},{value:"Device object was not found in the tenant &#39;xxxxxxxxxx&#39;",id:"device-object-was-not-found-in-the-tenant-xxxxxxxxxx",level:2},{value:"The provided grant has expired due to it being revoked, a fresh auth token is needed. The user might have changed or reset their password",id:"the-provided-grant-has-expired-due-to-it-being-revoked-a-fresh-auth-token-is-needed-the-user-might-have-changed-or-reset-their-password",level:2},{value:"Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access",id:"due-to-a-configuration-change-made-by-your-administrator-or-because-you-moved-to-a-new-location-you-must-use-multi-factor-authentication-to-access",level:2},{value:"presented multi-factor authentication has expired to the policies configured by your administrator, you must refresh your multi-factor authentication to access",id:"presented-multi-factor-authentication-has-expired-to-the-policies-configured-by-your-administrator-you-must-refresh-your-multi-factor-authentication-to-access",level:2},{value:"The token has expired",id:"the-token-has-expired",level:2},{value:"The property &#39;LastGraphError&#39; cannot be found on this object",id:"the-property-lastgrapherror-cannot-be-found-on-this-object",level:2},{value:"Credits",id:"credits",level:3}],d={toc:c};function p(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Below are some common issues that users have had from initial deployment, updating and general usage."),(0,r.kt)("p",null,"Note that these steps come from the community - if you notice any mistakes, please either edit this page or get in touch via the ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/Cyberdrain"},"Discord server"),". Please note the ",(0,r.kt)("a",{parentName:"p",href:"/docs/dev/#contributor-code-of-conduct"},"Contributor Code of Conduct"),"."),(0,r.kt)("h2",{id:"clear-token-cache"},"Clear Token Cache"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Hosted clients can contact the helpdesk directly to clear their token cache, and do not need to do this themselves. It's important that you send an email noting you've entered your keys, or ran the wizard, and are ready for a token cache clear."))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to Settings"),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("strong",{parentName:"li"},"Backend")),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("strong",{parentName:"li"},"Go to Function App Configuration")),(0,r.kt)("li",{parentName:"ol"},"At each item that has the source ",(0,r.kt)("em",{parentName:"li"},"Key Vault")," there should be a green checkbox. If there is no green checkbox, restart the function app and try in 30 minutes"),(0,r.kt)("li",{parentName:"ol"},"Rename the ",(0,r.kt)("em",{parentName:"li"},"RefreshToken"),", for example to ",(0,r.kt)("em",{parentName:"li"},"RefreshToken2")),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("strong",{parentName:"li"},"Save")),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("strong",{parentName:"li"},"Overview")," in the side menu"),(0,r.kt)("li",{parentName:"ol"},"Stop the app & wait 5 minutes."),(0,r.kt)("li",{parentName:"ol"},"Start the app"),(0,r.kt)("li",{parentName:"ol"},"Go back to ",(0,r.kt)("strong",{parentName:"li"},"Configuration")," in the side menu."),(0,r.kt)("li",{parentName:"ol"},"Reset the token names to their original values, for example back to ",(0,r.kt)("em",{parentName:"li"},"RefreshToken")," and then Select ",(0,r.kt)("strong",{parentName:"li"},"Save"),"."),(0,r.kt)("li",{parentName:"ol"},"Stop the app once more for 5 minutes then start it again.")),(0,r.kt)("p",null,"The tokens should no longer be in the cache."),(0,r.kt)("h2",{id:"multi-factor-authentication-troubleshooting"},"Multi-Factor Authentication Troubleshooting"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The account you use to generate your SAM tokens for CIPP must have Microsoft (Azure AD) MFA enabled, it can't use third-party MFA."),(0,r.kt)("li",{parentName:"ol"},"You can't have the ",(0,r.kt)("inlineCode",{parentName:"li"},"Allow users to remember multi-factor authentication on devices they trust")," option enabled in the ",(0,r.kt)("a",{parentName:"li",href:"https://account.activedirectory.windowsazure.com/UserManagement/MfaSettings.aspx"},"classic MFA admin portal"),". In either customer or the partner tenant."),(0,r.kt)("li",{parentName:"ol"},"Check our section on ",(0,r.kt)("a",{parentName:"li",href:"https://cipp.app/docs/user/gettingstarted/postinstall/conditionalaccess/"},"Conditional Access")," on how to handle Conditional Access issues.")),(0,r.kt)("h2",{id:"request-not-applicable-to-target-tenant"},"Request not applicable to target tenant."),(0,r.kt)("p",null,"The required license for this feature is not available for this tenant. Check the tenant's license information to ensure that it has the necessary license for the requested operation. Most seen around security tasks that require M365 BP or Azure AD P1."),(0,r.kt)("h2",{id:"neither-tenant-is-b2c-or-tenant-doesnt-have-premium-license"},"Neither tenant is B2C or tenant doesn't have premium license"),(0,r.kt)("p",null,"This feature requires a P1 license or higher. Check the license information of your clients tenant to ensure that they have the necessary licenses."),(0,r.kt)("h2",{id:"response-status-code-does-not-indicate-success-400-bad-request"},"Response status code does not indicate success: 400 (Bad Request)."),(0,r.kt)("p",null,"Error 400 occurred. There is an issue with the request. Most likely an incorrect value is being sent. If you receive this error with a permissions check, please redo your SAM setup."),(0,r.kt)("h2",{id:"microsoftskypesyncpstntnmcommonhttphttpresponseexception"},(0,r.kt)("em",{parentName:"h2"},"Microsoft.Skype.Sync.Pstn.Tnm.Common.Http.HttpResponseException")),(0,r.kt)("p",null,"Could not connect to Teams Admin center. The tenant might be missing a Teams license. Check the license information to ensure that the necessary licenses are available."),(0,r.kt)("h2",{id:"provide-valid-credential"},(0,r.kt)("em",{parentName:"h2"},"Provide valid credential.")),(0,r.kt)("p",null,"This occurs when GDAP has been deployed, but the user is not in any of the GDAP groups."),(0,r.kt)("h2",{id:"subscription-within-the-tenant-has-lapsed"},"subscription within the tenant has lapsed"),(0,r.kt)("p",null,"There is no Exchange subscription available, so exchange connections are no longer possible."),(0,r.kt)("h2",{id:"user-was-not-found"},(0,r.kt)("em",{parentName:"h2"},"User was not found.")),(0,r.kt)("p",null,"The relationship between this tenant and the partner has been dissolved from the ",(0,r.kt)("strong",{parentName:"p"},"client")," side. Check the partner relationship information and ensure that it is still active. This error also occurs when a GDAP relationship has expired."),(0,r.kt)("h2",{id:"the-user-or-administrator-has-not-consented-to-use-the-application"},(0,r.kt)("em",{parentName:"h2"},"The user or administrator has not consented to use the application")),(0,r.kt)("p",null,"Multiple Potential Causes:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The user has not authorized the CIPP-SAM Application. Use the Settings -> Tenants -> Refresh button to refresh the permissions."),(0,r.kt)("li",{parentName:"ol"},"The user that was used for the CIPP Authorisation is a guest in this tenant"),(0,r.kt)("li",{parentName:"ol"},"DAP: If the client is using DAP. The user might not be in the AdminAgents group."),(0,r.kt)("li",{parentName:"ol"},"GDAP: if you are using GDAP and have not added the user to the correct group(s) for CIPP to function. ")),(0,r.kt)("h2",{id:"aadsts50020-or-the-user-you-have-used-for-your-secure-application-model-is-a-guest-in-this-tenant-or-your-are-using-gdap-and-have-not-added-the-user-to-the-correct-group-please-delete-the-guest-user-to-gain-access-to-this-tenant"},(0,r.kt)("em",{parentName:"h2"},"AADSTS50020")," or The user you have used for your Secure Application Model is a guest in this tenant, or your are using GDAP and have not added the user to the correct group. Please delete the guest user to gain access to this tenant."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The user has not authorized the CIPP-SAM Application. Use the Settings -> Tenants -> Refresh button to refresh the permissions."),(0,r.kt)("li",{parentName:"ol"},"The user that was used for the CIPP Authorisation is a guest in this tenant"),(0,r.kt)("li",{parentName:"ol"},"DAP: If the client is using DAP. The user might not be in the AdminAgents group."),(0,r.kt)("li",{parentName:"ol"},"GDAP: if you are using GDAP and have not added the user to the correct group(s) for CIPP to function. ")),(0,r.kt)("h2",{id:"invalid-or-malformed"},(0,r.kt)("em",{parentName:"h2"},"invalid or malformed")),(0,r.kt)("p",null,"The request is malformed. the body does not contain JSON or variables have not expanded. Look for typos such as incorrect bracket usage"),(0,r.kt)("h2",{id:"windows-store-repository-apps-feature-is-not-supported-for-this-tenant"},(0,r.kt)("em",{parentName:"h2"},"Windows Store repository apps feature is not supported for this tenant")),(0,r.kt)("p",null,"This tenant does not have Intune WinGet support available. Check the licensing information to ensure that the necessary licenses are available."),(0,r.kt)("h2",{id:"aadsts650051"},"AADSTS650051"),(0,r.kt)("p",null,"The application was approved by the user, but does not exist yet. Wait 5 minutes and try to reauthorize."),(0,r.kt)("h2",{id:"applifecycle_2210"},(0,r.kt)("em",{parentName:"h2"},"AppLifecycle_2210")),(0,r.kt)("p",null,"Failed to call Intune APIs. Does the tenant have a license available? Check the license information to ensure that the necessary licenses are available."),(0,r.kt)("h2",{id:"insufficient-access-rights-to-perform-the-operation"},"Insufficient access rights to perform the operation."),(0,r.kt)("p",null,'The user does not have sufficient access rights to perform the operation or is missing the necessary Exchange role. Check the user\'s access rights and Exchange role information, when using GDAP the user must be in the "Exchange Administrators" group.'),(0,r.kt)("h2",{id:"device-object-was-not-found-in-the-tenant-xxxxxxxxxx"},"Device object was not found in the tenant 'xxxxxxxxxx'"),(0,r.kt)("p",null,'When executing the first authorization for CIPP, a trusted device was used. This device has been deleted from the Intune portal. Reauthorization is required by using the SAM Wizard "I\'d like to refresh my tokens" option.'),(0,r.kt)("h2",{id:"the-provided-grant-has-expired-due-to-it-being-revoked-a-fresh-auth-token-is-needed-the-user-might-have-changed-or-reset-their-password"},"The provided grant has expired due to it being revoked, a fresh auth token is needed. The user might have changed or reset their password"),(0,r.kt)("p",null,'The user that authorized the CSP or Graph API connection has had their password changed, sessions revoked, or account disabled. Reauthorization is required by using the SAM Wizard "I\'d like to refresh my tokens" option.'),(0,r.kt)("h2",{id:"due-to-a-configuration-change-made-by-your-administrator-or-because-you-moved-to-a-new-location-you-must-use-multi-factor-authentication-to-access"},"Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access"),(0,r.kt)("p",null,"This error can have two causes."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The user has not had MFA set up when performing authorization."),(0,r.kt)("li",{parentName:"ol"},"The client has Conditional Access policies blocking CIPP's access. See the chapter about Conditional Access to resolve.")),(0,r.kt)("h2",{id:"presented-multi-factor-authentication-has-expired-to-the-policies-configured-by-your-administrator-you-must-refresh-your-multi-factor-authentication-to-access"},"presented multi-factor authentication has expired to the policies configured by your administrator, you must refresh your multi-factor authentication to access"),(0,r.kt)("p",null,'This error occurs when a Conditional Access Policy has set the maximum lifetime. Suggested is to change the Conditional Access Policy to exclude "Service Provider users". See the chapter about how to resolve this under Conditional Access.'),(0,r.kt)("h2",{id:"the-token-has-expired"},"The token has expired"),(0,r.kt)("p",null,"The refresh token could not be retrieved and stored. The user must reauthorize. "),(0,r.kt)("h2",{id:"the-property-lastgrapherror-cannot-be-found-on-this-object"},"The property 'LastGraphError' cannot be found on this object"),(0,r.kt)("p",null,"This error occurs when CIPP cannot write to the errors table - Clear your tenant cache from the settings menu and try again."),(0,r.kt)("h3",{id:"credits"},"Credits"),(0,r.kt)("p",null,"This troubleshooting document was created with the help of ",(0,r.kt)("a",{parentName:"p",href:"https://www.linkedin.com/in/adelnet/"},"Ashley Cooper")))}p.isMDXComponent=!0}}]);